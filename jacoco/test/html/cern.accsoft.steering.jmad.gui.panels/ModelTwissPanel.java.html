<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ModelTwissPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jmad-gui</a> &gt; <a href="index.source.html" class="el_package">cern.accsoft.steering.jmad.gui.panels</a> &gt; <span class="el_source">ModelTwissPanel.java</span></div><h1>ModelTwissPanel.java</h1><pre class="source lang-java linenums">// @formatter:off
 /*******************************************************************************
 *
 * This file is part of JMad.
 * 
 * Copyright (c) 2008-2011, CERN. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 ******************************************************************************/
// @formatter:on

package cern.accsoft.steering.jmad.gui.panels;

import java.awt.Component;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;

import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;

import cern.accsoft.steering.jmad.domain.machine.Range;
import cern.accsoft.steering.jmad.domain.twiss.TwissInitialConditions;
import cern.accsoft.steering.jmad.domain.twiss.TwissListener;
import cern.accsoft.steering.jmad.model.AbstractJMadModelListener;
import cern.accsoft.steering.jmad.model.JMadModel;
import cern.accsoft.steering.jmad.model.JMadModelListener;
import cern.accsoft.steering.jmad.model.manage.JMadModelManager;
import cern.accsoft.steering.jmad.model.manage.JMadModelManagerAdapter;
import cern.accsoft.steering.util.gui.table.BeanTableEditHandler;
import cern.accsoft.steering.util.gui.table.BeanTableModel;

/**
 * this panel provides a table, in which one can edit the twiss parameters.
 * 
 * @author Kajetan Fuchsberger (kajetan.fuchsberger at cern.ch)
 */
public class ModelTwissPanel extends JPanel implements EditHandlerUser&lt;BeanTableEditHandler&gt; {
    private static final long serialVersionUID = 7182385328020991187L;

    /** The model manager, which provides the actual model */
    private JMadModelManager modelManager;

    /** The table model which will contain the twiss-parameters */
<span class="fc" id="L56">    private BeanTableModel doubleTableModel = new BeanTableModel(TwissInitialConditions.class);</span>

    /** The table model for boolean values */
<span class="fc" id="L59">    private BeanTableModel booleanTableModel = new BeanTableModel(TwissInitialConditions.class);</span>

    /** The model which we display */
    private JMadModel model;

    /**
     * the listener, which is attached to all the models.
     */
<span class="fc" id="L67">    private JMadModelListener modelListener = new AbstractJMadModelListener() {</span>

        @Override
        public void rangeChanged(Range newRange) {
<span class="nc" id="L71">            refreshTwiss();</span>
<span class="nc" id="L72">        }</span>

    };

<span class="fc" id="L76">    private TwissListener twissListener = new TwissListener() {</span>

        @Override
        public void changedTwiss(TwissInitialConditions twiss) {
<span class="nc" id="L80">            doubleTableModel.fireTableDataChanged();</span>
<span class="nc" id="L81">            booleanTableModel.fireTableDataChanged();</span>
<span class="nc" id="L82">        }</span>
    };

    /**
     * the default constructor
     */
<span class="fc" id="L88">    public ModelTwissPanel() {</span>
<span class="fc" id="L89">        initComponents();</span>
<span class="fc" id="L90">    }</span>

    /**
     * create all the components
     */
    private void initComponents() {
<span class="fc" id="L96">        setLayout(new GridBagLayout());</span>

<span class="fc" id="L98">        GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="fc" id="L99">        constraints.gridx = 0;</span>
<span class="fc" id="L100">        constraints.gridy = 0;</span>
<span class="fc" id="L101">        constraints.weightx = 1;</span>
<span class="fc" id="L102">        constraints.weighty = 4;</span>
<span class="fc" id="L103">        constraints.fill = GridBagConstraints.BOTH;</span>

        JTable table;

<span class="fc" id="L107">        this.doubleTableModel.setEditable(true);</span>
<span class="fc" id="L108">        table = new JTable(this.doubleTableModel);</span>
<span class="fc" id="L109">        add(createScrollPane(table), constraints);</span>

<span class="fc" id="L111">        constraints.gridy++;</span>
<span class="fc" id="L112">        constraints.weighty = 1;</span>
<span class="fc" id="L113">        this.booleanTableModel.setEditable(true);</span>
<span class="fc" id="L114">        this.booleanTableModel.setValueClasses(new Class&lt;?&gt;[] { Boolean.class, boolean.class });</span>
<span class="fc" id="L115">        table = new JTable(this.booleanTableModel);</span>
<span class="fc" id="L116">        add(createScrollPane(table), constraints);</span>
<span class="fc" id="L117">    }</span>

    /**
     * creates a scrollPane containing the given component
     * 
     * @param component the component, which shall be included in the scrollPane
     * @return the scrollPane
     */
    private JScrollPane createScrollPane(Component component) {
<span class="fc" id="L126">        return new JScrollPane(component, JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,</span>
                JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
    }

    /**
     * sets the active model and registers the listener if required
     * 
     * @param model the model to set
     */
    private void setModel(JMadModel model) {
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">        if (model == null) {</span>
<span class="fc" id="L137">            return;</span>
        }
<span class="nc" id="L139">        this.model = model;</span>
<span class="nc" id="L140">        model.addListener(modelListener);</span>
<span class="nc" id="L141">        refreshTwiss();</span>
<span class="nc" id="L142">    }</span>

    private void refreshTwiss() {
<span class="nc" id="L145">        TwissInitialConditions twiss = this.model.getTwissInitialConditions();</span>
<span class="nc" id="L146">        twiss.addListener(twissListener);</span>
<span class="nc" id="L147">        this.doubleTableModel.setBean(twiss);</span>
<span class="nc" id="L148">        this.doubleTableModel.fireTableDataChanged();</span>
<span class="nc" id="L149">        this.booleanTableModel.setBean(twiss);</span>
<span class="nc" id="L150">        this.booleanTableModel.fireTableDataChanged();</span>
<span class="nc" id="L151">    }</span>

    /**
     * @param modelManager the modelManager to set
     */
    public void setModelManager(JMadModelManager modelManager) {
<span class="fc" id="L157">        this.modelManager = modelManager;</span>

<span class="fc" id="L159">        setModel(this.modelManager.getActiveModel());</span>

<span class="fc" id="L161">        this.modelManager.addListener(new JMadModelManagerAdapter() {</span>

            @Override
            public void changedActiveModel(JMadModel newModel) {
<span class="nc" id="L165">                setModel(newModel);</span>
<span class="nc" id="L166">            }</span>
        });
<span class="fc" id="L168">    }</span>

    /**
     * set an (optional) edit handler to the double-table model. This can be used to select certain properties of the
     * twiss, to allow to e.g. use them as variation parameters.
     * 
     * @param editHandler the editHandler to set
     */
    @Override
    public void setEditHandler(TablePanelEditHandler editHandler) {
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (editHandler instanceof BeanTableEditHandler) {</span>
<span class="nc" id="L179">            this.doubleTableModel.setEditHandler((BeanTableEditHandler) editHandler);</span>
        }
<span class="nc" id="L181">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>